<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>公開ディレクトリ — テスト点数記録表</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header class="site-header card">
      <div class="header-left">
        <h1>公開ディレクトリ</h1>
        <p class="subtitle">みんなが提出したテスト記録の一覧（管理者が registry.json を更新することで反映されます）</p>
      </div>
      <div class="header-right">
        <a href="index.html" class="btn">アプリを開く</a>
        <div class="version-label" id="versionLabel">v1.01</div>
      </div>
    </header>

    <section class="card features">
      <h2>最新機能（v1.01）</h2>
      <ul>
        <li>教科リストのテンプレート機能
          <div class="feature-detail">よく使う教科リストをテンプレートとして保存・共有できます</div>
        </li>
        <li>グラフ表示の強化
          <div class="feature-detail">共有データとの比較を同じグラフ上で視覚的に確認できます</div>
        </li>
        <li>自動比較機能
          <div class="feature-detail">共有データを貼り付けると自動的に比較結果を表示します</div>
        </li>
      </ul>
    </section>

    <section class="card">
      <h2>公開データ一覧</h2>
      <div id="dirList">読み込み中…</div>
    </section>

    <footer class="tiny card">
      <div>提出方法：</div>
      <ul>
        <li>アプリ内の「公開ディレクトリへ投稿」ボタンを使用（推奨）</li>
        <li>リポジトリに Issue を作成</li>
        <li>Pull Request を送信</li>
      </ul>
      <div>※管理者が registry.json を更新することで反映されます</div>
    </footer>
  </main>

  <script>
    async function loadRegistry(){
      try{
        const res = await fetch('./registry.json', {cache: 'no-store'});
        if(!res.ok) return document.getElementById('dirList').innerText = '公開データはありません';
        const data = await res.json();
        if(!Array.isArray(data) || !data.length) return document.getElementById('dirList').innerText = '公開データはありません';
        const container = document.getElementById('dirList');
        let html = '<ul class="card">';
        data.forEach(item=>{
          html += `<li style="padding:12px;border-bottom:1px solid #f1f5f9"><strong>${item.username || '名無し'}</strong> — ${item.name || ''}<br><small class="subtitle">教科: ${ (item.subjects||[]).map(s=>s.name).join(', ') }</small></li>`;
        });
        html += '</ul>';
        container.innerHTML = html;
      }catch(e){ document.getElementById('dirList').innerText = '読み込みに失敗しました'; }
    }
    loadRegistry();
  </script>
</body>
</html>
